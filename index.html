<!DOCTYPE HTML>
<!--
	Escape Velocity by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Sempro Technologies</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<base href="/" />
		<link rel="stylesheet" href="/assets/css/main.css" />
		<link rel="stylesheet" href="/assets/css/auth-modal.css" />
		<link rel="stylesheet" href="/assets/css/liturgie-editor.css" />
		<link rel="stylesheet" href="/assets/css/year-month-picker.css" />
		<link rel="stylesheet" href="/assets/css/table-sort.css" />
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
	</head>
	<body class="right-sidebar is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<section id="header" class="wrapper">

					<!-- Logo -->
						<div id="logo">
							<h1><a href="index.html">Sempro Technologies</a></h1>
						</div>

					<!-- Nav -->
						<nav id="nav">
							<ul>
								<li><a href="index.html">Home</a></li>
								<li><a href="javascript:void(0)" onclick="openWorklogTable()">Data Table</a></li>
								<li><a href="javascript:void(0)" onclick="SimpleAuth.showLoginModal()">Login</a></li>
						
							</ul>
						</nav>

				</section>

			<!-- Main -->
				<section id="main" class="wrapper style2">
					<div class="container">
						<div class="row gtr-150">
							<div class="col-9 col-12-medium">
								<!-- Content -->
								<div id="content">
									<a class="image">
										<img src="/api/retrieve/graph" alt="" onerror="if(window.SimpleAuth && !window.SimpleAuth.isAuthenticated) { SimpleAuth.handleUnauthorized(); }" />
									</a>
									<p>"Please login"</p>
								</div>
							</div>
							<div class="col-3 col-12-medium">
								<!-- Sidebar -->
								<section id="sidebar">
									<div class="year-month-picker">
										<div class="picker-header">
											<span class="picker-title">Select Year</span>
										</div>
										<div class="picker-content" id="year-picker-content">
											<select id="year-select" class="year-select">
												<!-- Years will be dynamically added here -->
											</select>
										</div>
									</div>
									
									<div class="hour-type-picker">
										<div class="picker-header" id="hour-type-toggle">
											<span class="picker-arrow collapsed">â–¼</span>
											<span class="picker-title">Hour Types</span>
										</div>
										<div class="picker-content collapsed" id="hour-type-content">
											<!-- Hour types will be dynamically added here -->
										</div>
									</div>
								</section>
							</div>
						</div>
					</div>
				</section>

			<!-- Highlights -->
				

			<!-- Footer -->
				<section id="footer" class="wrapper">
					<div class="container">						
						<div class="row">
							<div class="col-6 col-12-medium">
			
						<div id="copyright">
							<ul>
								<li>&copy; dSea. [visitors] visitors</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</div>
				</section>

		</div>

		<!-- Scripts -->
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/jquery.dropotron.min.js"></script>
			<script src="/assets/js/browser.min.js"></script>
			<script src="/assets/js/breakpoints.min.js"></script>
			<script src="/assets/js/util.js"></script>
			<script src="/assets/js/main.js"></script>		<script src="/assets/js/liturgie-loader.js"></script>			<script src="/assets/js/simpleauth.js"></script>
		<script src="/assets/js/liturgie-editor.js"></script>
		<script src="/assets/js/year-month-picker.js"></script>
		<script src="/assets/js/hour-type-picker.js"></script>
		<script src="/assets/js/graph-loader.js"></script>
		<script src="/assets/js/table-sort.js"></script>
		<script>
			function openWorklogTable() {
				// Get current selections
				var year = window.YearMonthPicker ? window.YearMonthPicker.getSelectedYear() : new Date().getFullYear();
				var hourTypes = window.HourTypePicker ? window.HourTypePicker.getSelection().join(', ') : 'Mechanical hours, Software hours, Visit hours';
				
				// Get token if authenticated
				var token = sessionStorage.getItem('pgad_token');
				
				// Build URL with parameters
				var url = '/worklog-table.html?year=' + year + '&hourType=' + encodeURIComponent(hourTypes);
				if (token) {
					url += '&token=' + token;
				}
				
				// Fetch the partial HTML and update the content area
				$.ajax({
					url: url,
					method: 'GET',
					headers: token ? { 'X-Auth-Token': token } : {},
					success: function(html) {
						$('#content').html(html);
					// Trigger event for table sorting initialization
						$(document).trigger('worklogTableLoaded');
					},
					error: function(xhr) {
						if (xhr.status === 401) {
							SimpleAuth.handleUnauthorized();
						} else {
							$('#content').html('<p style="color: red; padding: 40px; text-align: center;">Error loading worklog data.</p>');
						}
					}
				});
			}
			
			// Auto-update data table when year or hour types change (if table is visible)
			$(document).ready(function() {
				$(document).on('yearSelectionChanged hourTypeSelectionChanged', function() {
					// Check if worklog table is currently displayed
					if ($('#content .worklog-data-content').length > 0) {
						console.log('Selection changed - reloading data table');
						openWorklogTable();
					}
				});
				
				// Also update when user logs in/out and table is visible
				$(document).on('loginSuccess', function() {
					if ($('#content .worklog-data-content').length > 0) {
						console.log('Login success - reloading data table');
						openWorklogTable();
					}
				});
			});
		</script>
</html>